# 操作系统简介

## 什么是操作系统

一、用户与硬件之间的接口
大多数应用软件的开发者可以在不了解计算机硬件接口的情况下编写大量的应用程序。操作系统必须完成的两个主要目标如下：
1) 与硬件部分相互作用，为包含在硬件平台上的所有底层可编程部件提供服务。
2) 为运行在计算机系统上的应用程序（即所谓用户程序）提供执行环境。

二、 资源的管理者
现代计算机系统的一个重要特点就是支持多任务，即允许在同一个系统内同时驻留多个应用程序。
多个应用程序共同使用计算机硬件和软件资源时，就需要操作系统对这些资源进行有效的管理。
一方面保证用户程序的顺利执行，另一方面使计算机系统资源得到尽可能高效的利用，保证计算机系统的高性能。 
操作系统所管理的资源主要包括处理机、内存、设备和文件，在网络操作系统中还包括网卡、带宽等。

1. 处理机管理
由于程序的执行必须依靠处理机，任意时刻处理机都只能执行一个程序流。
因此，在单处理机系统中执行多个程序流，必须由操作系统的处理机调度程序来管理处理机的分配，以使多个程序共享处理机，从宏观上看多个程序能同时顺利执行。在多处理机系统中，也需要操作系统对多个处理机在多任务的情况下进行有效的管理。

2. 内存管理
在多任务系统中，内存不再是独占资源，而是可能被多个应用程序共同占用。如何为多个应用程序分配内存并使不同应用程序的地址空间互不干扰，如何在程序执行完毕后回收其所占内存，以及完成逻辑地址到物理地址的转换，都是操作系统内存管理程序要完成的功能。

3. 设备管理
设备管理主要完成接受用户的I/O请求、为用户分配I/O设备、管理I/O缓存和驱动I/O设备等功能。

4. 文件管理
计算机系统把大量需要长时间保留的数据信息以文件的形式存放在外存储设备中（如硬盘、光盘、磁带和U盘），操作系统通过自己的文件管理程序完成外存空间的分配、回收、文件的按名存放、文件的组织、共享与保护等功能。

## 操作系统的发展
操作系统是在解决计算机系统所面临的问题中诞生并发展的自然结果。操作系统的发展从时间顺序上经历了从无操作系统到单道批处理系统，多道程序系统（多道批处理系统、分时系统）的发展过程。随着计算机应用领域的扩大、计算机体系结构的多样化，又出现了微机操作系统、网络操作系统、实时操作系统、嵌入式操作系统和物联网操作系统。

一、 无操作系统
第一代计算机（1945 - 1955） 使用电子管作为主要的电子器件，用插件版上的硬连线或穿孔卡片表示程序，没有用来存储程序的内存，无操作系统。

二、 单道批处理系统
第二代计算机（1955 - 1965）使用的主要电子器件是晶体管，开始使用磁性存储设备，内外存容量增加，计算机运算速度提高，出现了早起的单道批处理系统。
内存中只能驻留一道用户作业，CPU和内存资源被用户作业独占。程序是指令的集合，程序的执行是CPU依次、逐条执行指令的过程。
当执行到输入/输出指令时，启动设备控制器工作。在设备控制器控制设备完成输入/输出（磁带和内存之间的数据传输）的一段时间内是不需要CPU干预的。在单道批处理系统的管理下，此时间段内CPU空闲，无事可做。 对于租用计算机的用户而言，损失了CPU的机时，而计算机系统损失了系统的吞吐量。
吞吐量是指单位时间内计算机系统处理的作业量。

三、多道程序系统
随着电子技术的发展，计算机开始采用集成电路芯片作为主要的电子器件，IBM360是第一个采用小规模集成电路芯片的主流机型。
这个时期，生产厂商试图通过生产通用计算机，把用于科学计算、工程计算及磁带归档、打印处理的两类计算机合二为一。
但是通用计算机存在一个问题，对于CPU操作密集型的作业（即使用CPU频率高的作业），输入、输出操作较少，CPU利用率比较高。
但是，当通用计算机用于运行输入和输出密集型的作业时，由于CPU频繁等待输入，输出，而CPU在等待输入、输出完成的过程中只能原地踏步，无法进行任何有效的工作，使CPU的浪费最多可达90%。
为了解决这一问题

多道程序系统的最初想法是将内存分为几个部分，每一部分存放不同的作业，当一个作业等待输入/输出操作完成时，另一个作业可以使用CPU。
任何时刻，当一个作业运行完毕，操作系统会自动从外存装入另一个作业到空闲的内存区域。
从理论上讲，如果内存中可以同时存放足够多的作业，则CPU利用率可以接近100%

早期的多道程序系统不具有交互功能，被称为多道批处理系统。

第一个通用分时系统，是麻省理工学院1962年在一台改装过的IBM7094上开发成功的，后续又出现了MULTICS，UNIX，LINUX，和WINDOWS等著名即支持多道批处理功能，又支持分时功能的多道程序系统。

四、 微机操作系统
第一个微机操作系统是Intel公司的顾问，编写的CP/M 系统。
这是一个磁盘操作系统，用于Intel8080. 1977年，CP/M被重写，使其可以在使用Intel8080、Zilog Z80及其他CPU芯片的多种微型计算机上运行。从此，CP/M在微机操作系统市场奉行了几年，成为了著名的8位操作系统。
20世纪80年代初，IBM进军个人计算机市场。

五、 实时操作系统
实时操作系统可以使用操作系统，也可以不用操作系统。在高端的实时系统中通常都有高可靠性和支持实时资源调度的实时操作系统（RTOS）
VxWorks操作系统是 美国 WindRiver 于 1983年设计开发的一种嵌入式实时操作系统。

六、 批处理系统、分时系统、实时系统的特点
1. 单道批处理系统的特点
单道批处理系统内存中只有一道作业，可以自动成批处理作业，特点如下
(1) 自动性
(2) 顺序性
(3) 单道性

2. 多道批处理系统的特点
在多道批处理系统中，用户所提交的作业都先存放在外存中并排成一个队列，该队列被称为“后备作业队列”。
由操作系统的作业调度程序按一定策略从后备作业队列中选择若干个作业调入内存，使它们共享CPU和系统中的各种资源，以达到提高资源利用率和系统吞吐量的目的。
与单道批处理系统相比，多道批处理系统支持多道程序驻留内存，CPU可以不再空闲等待I/O。 多道批处理系统的特点如下：
(1) 多道性
(2) 无序性
(3) 调度性
(4) 复杂性

3. 分时系统的特点
分时系统允许多个用户通过终端同时使用计算机。
分时操作系统是多道程序系统的自然延伸，支持多个用户任务同时驻留内存，每个用户通过终端与主机交互时都能得到快速响应。
分时系统的特点是多路性、独立性、及时性和交互性。

多路性是指允许在一台主机上同时链接多台联机终端。
独立性是指各终端用户彼此独立操作，互不干扰。
及时性是指用户请求能在很短的时间内获得响应。
交互性是指用户可以通过终端与系统进行广泛的人机对话。

分时系统的优点是向用户提供了人机交互的方便性，使多个用户可以通过不同的终端共享主机。

分时系统的实现需要解决两个关键问题，即及时接收和及时处理。同时连接多个用户终端的分时系统要能及时接收用户的命令或数据，新用户命令到来时，尚未处理的用户命令要通过缓冲区来妥善保存。此外，分时系统要能及时处理用户的交互命令，使系统的响应时间得到保证。为了实现这一目标，应该使所有的用户任务都直接进入内存，并在很短的时间内使每个任务都运行一次。

4. 实时系统的特点
实时系统主要用于实时控制和实时信息处理领域。
实时系统必须能及时响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。与分时系统相比，实时系统具有如下特点。
(1) 多路性
实时系统的多路性除具有与分时系统相同的特点外，主要表现在经常对多路的现场信息进行采集，以及对多个对象或多个执行机构进行控制。

(2) 独立性
实时系统与分时系统一样，每个终端用户在向实时系统提出服务请求时，是彼此独立地操作，互不干扰。而在实时控制系统中，信息的采集和对对象的控制也是彼此互不干扰。

(3) 及时性
实时信息处理系统对实时性的要求是以人所能接受的等待时机来确定的，而实时控制系统的及时性则是控制对象所要求的开始截止时间或完成截止时间来确定的。

(4) 交互性
实时信息系统的交互性仅限于访问系统某些特定的专用服务程序

(5) 可靠性
实时系统比分时系统要求有更高的可靠性。因为任何实时系统的错误都能带来巨大的经济损失，甚至危及生命安全。因此，在实时系统中，往往采取多级容错措施来保证系统安全和数据安全。

七、 操作系统产品现状
1. 主机操作系统
主机操作系统是运行在大型主机上的操作系统，主要提供三类服务：批处理、事务处理和分时处理。
批处理系统处理不需要交互式用户干预的周期性作业，保险公司的索赔处理或者连锁商店的销售报告以批处理的方式完成。
事务处理系统负责大量的小请求。
分时系统允许多个远程用户同时在计算机上工作，执行命令或处理作业。

2. 服务器操作系统
服务器操作系统是运行在网络服务器上的操作系统，可以通过网络同时为众多用户服务，允许用户共享硬件和软件资源。服务器可提供打印服务、文件服务和Web服务。
典型的服务器操作系统有Solaris，FreeBSD，Linux

3. 微机操作系统
微机操作系统也称为个人机操作系统，现代微机操作系统都支持多道程序处理，就是通常所说的支持多任务。微机操作系统为个人用户提供良好的应用环境和应用软件开发环境。常见的微机操作系统有Windows的个人计算机操作系统系列。

4. 嵌入式操作系统
嵌入式系统的概念出现在20世纪70年代，是宿主于非计算机设备中的计算机系统。嵌入式操作系统是运行于嵌入式设备中的操作系统。

## 操作系统的特征
现代操作系统都支持，多任务，具有并发、共享、虚拟和异步性特征。
1. 并发
并发是指两个或多个事件在同一时间间隔内发生。 
并发强调“同一时间间隔”与并发是有区别的两个不同的概念，并行是指多个事件同时发生。
以单CPU多任务的操作系统为例，当说两个程序并发执行时，是指从宏观上看这两个程序同时在向前推进。
但是，在单CPU单核的系统中，任意时刻只能有一个程序流在CPU上执行，要么是编辑文档程序，要么是音频播放程序。之所以用户能感觉到两个程序似乎在同时工作，而且互不干扰，是因为操作系统使两个程序在CPU上快速地交替执行，实现了“并发”的功能。

2. 共享
共享是指系统中的资源可供内存中多个并发执行的进程共同使用。资源共享有两种方式，即互斥共享和同时共享。
互斥共享是指任意时刻一种资源只能被一个进程访问，当一个进程访问资源时，其他进程必须等待，直到资源被进程访问完毕，释放访问权。如果不采取互斥访问的方式，可能会把多个进程的输出内容打印到同一页打印纸上。
同时，共享是指从宏观上看，资源可以被多个进程同时访问，如对磁盘对访问。虽然任意时刻只能有一个程序访问某个磁盘。但是，多个程序可以在短时间内轮流访问该磁盘，从用户的角度看，多个用户程序可以同时发送磁盘访问命令，并可以同时得到响应。从宏观上看，磁盘可以被多个用户程序同时访问。
并发和共享是相互依赖的。如果系统不支持并发，资源的使用都是独占的，不需要共享资源。另一方面，如果不能实现有效的资源共享，并发就不可能得到很好的支持。

3. 虚拟
虚拟是指通过某种技术把一个物理实体变成若干逻辑上的对应物。物理实体是实际存在的，而虚拟仅仅是用户感觉到的。如虚拟打印机、虚拟内存和虚拟CPU等，都是操作系统通过某种技术把少量的物理资源变成较物理资源多的逻辑资源，使共享资源的每个用户都感觉到自己独占了系统资源。

4. 异步性
进程以不可预知的速度向前推进。内存中的每个程序何时执行、何时暂停、以怎样的速度向前推进，以及每道程序总共需要多少时间才能完成等。都是不可以预知的。系统中什么时候会出现需要特殊处理的事件，如键盘中断、鼠标中断等也是随机的、不可预知的。

## 操作系统的功能

一、 内存管理
内存管理的主要任务是为多道程序的运行提供良好的环境，方便用户使用内存，提高内存的利用率，以及从逻辑上扩充内存以实现虚拟存储。
内存管理应具有内存分配、内存保护、地址映射和内存扩充功能。

1. 内存分配
内存分配的主要任务是为每道程序分配内存空间，使它们各得其所。提高存储器的利用率，以减少不可用的内存空间。允许正在运行的程序申请附加的内存空间，以适应程序和数据动态增长的需要。
操作系统可以采用两种方式实现内存分配，即静态分配方式和动态分配方式。采用静态分配方式是把内存划分成固定大小和数量一定的区域，在系统运行过程中各分区的大小和数量不再变化。采用动态分配方式是系统在运行过程中，根据进程的请求分配内存，内存中分区的大小和数量都是动态变化的。
为了实现内存的分配，需要以下数据结构和功能支持
(1) 用于内存分配数据结构。用来记录内存使用状况，如内存空闲区域的大小、空闲区域的起始地址等，为实现分配的实现提供依据。
(2) 内存分配功能。 系统按照一定的内存分配算法分配内存空间。
(3) 内存回收功能。 系统需要回收被释放的内存空间。

2. 内存保护
内存保护的任务： 一是使操作系统内核的空间不会被用户随意访问，以保证系统的安全和稳定；二是确保每道用户程序都在自己的内存空间中运行，互不干扰。 实现的方式可以采用界限寄存器存放允许程序访问的地址区间的上限和下限值。程序运行期间访问内存时，把访问地址与界限寄存器的值相比较，如果发生越界，便发出越界中断请求，以停止该程序的运行。

3. 地址映射
CPU执行程序过程中访问内存时，需要把程序的罗地址转变为物理地址，这个转换的过程称为地址映射。
(1) 逻辑地址与物理地址
一个应用程序经编译后，通常会形成若干个目标程序，这些目标程序再经过链接而形成可装入程序。这些程序中指令和数据的地址都是相对于编译链接后的机器代码程序的其实地址计算的，由这些地址所形成的地址范围成为地址空间，其中的地址称为逻辑地址。

(2) 地址映射
在多道程序系统中，地址空间中的逻辑地址和内存中的物理地址是不一致的。因此，存储器管理必须提供地址映射功能，以将逻辑地址转换为对应的物理地址。

4. 内存扩充
内存扩充的任务是借助于虚拟存储及时，从逻辑上扩充内存容量，使系统能够向用户提供比物理内存大的存储容量。为了能从逻辑上扩充内存，系统必须具有内存扩充机制，以实现下列功能。
(1) 请求调入功能
允许系统在装入一部分用户程序时就启动该程序的运行，在程序运行过程中若发现要执行的指令或要访问的数据尚未装入内存，通过请求调入将需要的指令或数据装入内存。

(2) 置换功能
在请求调入时，若发现内存空间不足，需要系统先将内存中的一部分内容换出到外存中，以便腾出内存空间装入当前需要的内容。

二、 进程管理
进程可以被认为是程序的执行实体
进程管理功能主要包括进程的描述与组织、进程控制、进程同步、进程通信及进程调度。
进程控制完成进程创建、撤销进程、唤醒进程和阻塞进程等操作。
进程同步功能完成多个进程（含线程）运行等协调与互斥。
进程通信功能用来实现进程之间等信息交换。
进程调度功能是从多个可执行的程序中选出一个进程，把处理机分配给它。

三、 设备管理
设备管理主要完成用户的I/O请求，为用户分配I/O设备。

(1) 缓冲管理。管理各种缓冲区
(2) 设备分配。分配用户I/O所需要的设备。
(3) 设备处理。 由设备驱动程序来实现CPU与设备控制器之间的通信。
(4) 设备独立性和虚拟设备。 设备独立性功能使应用程序独立于物理设备。

四、 文件管理

1. 文件存储空间的管理
为每个文件分配必要的外存恐惧，提高外存利用率， 并能有助于提高访问文件的速度。

2. 目录管理
为每个文件建立目录项并对众多目录项进行有效组织。
目录项包括文件名、文件属性及文件的地址等信息。

3. 文件的读、写管理和存取控制
根据用户的请求，从外存中读取数据或将数据写入外存。
防止未经核准的用户存取文件，防止冒名顶替存取文件，防止以不正确的方式使用文件。

五、 提供用户接口
为了方便用户使用操作系统，操作系统向用户提供了用户操作系统之间的接口。
操作系统向最终用户提供命令行和图形用户接口，向程序员提供应用程序与操作系统之间的接口即系统调用。
系统调用是操作系统实现的具有某种功能的程序模块，应用程序可以通过系统调用的接口使用操作系统实现的功能，获得操作系统内核的服务。

1. 命令接口
为了便于用户与计算机系统的交互，早期的操作系统都向用户提供了命令接口。
接口又分为联机用户接口和脱机用户接口。
(1) 联机用户接口
为了联机用户设计的接口，它由一组键盘操作命令和命令解析程序组成。

(2) 脱机用户接口
脱机用户接口是为批处理作业的用户提供的，也称为批处理用户接口。

2. 图形用户接口
20世纪90年代，在操作系统中开始引入图形化用户接口。
在提供图形用户接口的操作系统中，用户可以轻松地通过选择窗口、菜单、对话框、滚动条、图标等简单的操作来完成对作业和任务的提交与控制。
用户不必记住与操作对应的命令和命令参数的格式。
用户图形接口使操作计算机成为相对简单的事情，也使更多的非专业人士能很快掌握计算机的应用程序的操作。

3. 程序接口
操作系统提供给程序员的接口是系统调用。在类UNIX系统中，系统调用多使用C语言所提供的库函数。

## 操作系统的体系结构

一、 软件体系结构简介

二、 操作系统体系结构的分析

1. 简单的监控程序模型
2. 单体结构模型
3. 层次结构模型
4. 客户/服务器模型与微内核结构
5. 动态可扩展结构模型

## 指令的执行
为了更好地理解操作系统原理的内容，在此对程序执行的本质及其与硬件、指令集的关系以一个简化的实例加以说明。
程序是指令的集合，程序的执行就是按照某种控制流执行指令的过程。

1. 指令周期
一个单一指令需要的处理称为指令周期，一个指令周期可以划分成两个步骤，分别是取指令周期和执行周期。

2. 取指令和执行指令
(1) 取指令
在每个指令周期开始时，处理器从存储器中取一条指令。
在典型的固定长度指令的处理器中，程序计数器PC保存有下一次要取得指令的地址。
除非接收到别的知识，否则处理器在每次完成指令操作后总是对PC递增，使它能够按顺序取得下一条指令，即位于下一个高端存储器地址的指令。

(2) 执行指令
取到的指令被放置在处理器的指令寄存器IR中。指令中包含确定处理器将要采取动作的位，处理器解除指令并执行要求的动作，这些动作可分为4类。
(1) 处理器与存储器之间的指令或数据传送操作。
(2) 处理器与I/O设备之间的指令或数据传送操作。
(3) 算术运算操作或逻辑运算操作。
(4) 操作控制，即修改指令的执行顺序的操作。

指令的执行小结
程序执行的过程是反复取指令和执行指令的过程。
PC始终存有下一条待取指令的地址。指令执行的结果就是使寄存器或内存单元的值发生变化，指令执行的过程也就是存储体内容不断变化的过程。
取指令和执行指令是由硬件完成的，不同硬件的体系结构支持不同的指令集合，为某一种硬件平台开发的操作系统不能直接在另一种体系结构的硬件上运行。任何高级程序语言的高级被编译成指令集和，其中的每一条指令属于计算机体系结构的指令集。


